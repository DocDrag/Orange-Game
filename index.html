<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game Board</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css" />
</head>

<body class="bg-gray-100 min-h-screen flex flex-col items-center p-6 pt-10">
    <!-- Navbar ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤ -->
    <nav class="w-full flex items-center justify-between px-6 py-3 bg-white shadow mb-6 fixed top-0 left-0 z-50">
        <!-- ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏£‡∏π‡∏õ‡∏™‡πâ‡∏° (‡πÉ‡∏ä‡πâ emoji) -->
        <div class="flex items-center gap-2">
            <span class="text-3xl">üçä</span>
            <span class="font-bold text-xl text-orange-600">‡πÄ‡∏Å‡∏°‡∏™‡πâ‡∏°</span>
        </div>
        <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
    </nav>

    <!-- ‡∏Ç‡∏¢‡∏±‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏•‡∏á‡∏°‡∏≤‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ö Navbar -->
    <div class="pt-16"></div>

    <!-- Game Board + ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤ -->
    <div class="relative flex flex-row items-start justify-center w-full">
        <!-- ‡∏î‡∏±‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ Game Board ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á -->
        <div id="left-space"
            class="flex flex-col justify-between items-center mr-16"
            style="height: 100%;">
        </div>
        <!-- Game Board -->
        <div class="relative" id="game-wrapper">
            <svg class="absolute top-0 left-0 w-full h-full pointer-events-none z-0" id="lines"></svg>
            <div class="grid grid-cols-7 gap-4 relative z-10" id="game-board"></div>
        </div>
        <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 4 ‡∏õ‡∏∏‡πà‡∏° -->
        <div id="add-player-buttons"
            class="flex flex-col justify-between items-center ml-16"
            style="height: 100%;">
            <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ JS ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö Game Board -->
        </div>
    </div>

    <!-- ‡∏ß‡∏á‡∏•‡πâ‡∏≠ -->
    <div class="relative flex flex-col items-center gap-5 mt-3">
        <!-- ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå -->
        <div id="result" class="text-xl font-bold text-[#333] text-center min-h-[30px]"></div>

        <!-- Wheel (conic-gradient) -->
        <div class="relative w-[300px] h-[300px]">
            <!-- Pointer -->
            <div
                class="absolute -top-2 left-1/2 -translate-x-1/2 w-0 h-0 border-l-[15px] border-l-transparent border-r-[15px] border-r-transparent border-t-[20px] border-t-[#333] z-10">
            </div>
            <div id="wheel" 
                 class="w-full h-full rounded-full shadow-[0_10px_30px_rgba(0,0,0,0.3)] transition-transform duration-[1500ms] ease-[cubic-bezier(0.25,0.1,0.25,1)] border-4 border-white cursor-pointer"
                 style="background: conic-gradient(
                     from 0deg,
                     #FF5722 0deg 216deg,
                     #FF9800 216deg 324deg,
                     #FFC107 324deg 360deg
                 );">
                <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô -->
                <div class="absolute inset-0 flex items-center justify-center">
                    <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1 -->
                    <div class="absolute text-white font-bold text-5xl" 
                         style="transform: rotate(108deg) translateY(-80px) rotate(-108deg);">1</div>
                    <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2 -->
                    <div class="absolute text-white font-bold text-5xl" 
                         style="transform: rotate(270deg) translateY(-80px) rotate(-270deg);">2</div>
                    <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3 -->
                    <div class="absolute text-white font-bold text-5xl" 
                         style="transform: rotate(342deg) translateY(-80px) rotate(-342deg);">3</div>
                </div>
            </div>
            <!-- Spin Button -->
            <button id="spinBtn"
                class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-20 h-20 rounded-full bg-[#333] z-10 pointer-events-none">
            </button>
        </div>
    </div>
    
    <script>
        let isSpinning = false;
        let currentRotation = 0;

        const wheel = document.getElementById('wheel');
        const spinBtn = document.getElementById('spinBtn');
        const result = document.getElementById('result');

        function spinWheel() {
            if (isSpinning) return;

            isSpinning = true;
            spinBtn.disabled = true;
            result.textContent = '';

            const randomRotation = Math.floor(Math.random() * 1800) + 1800;
            currentRotation -= randomRotation;

            wheel.style.transform = `rotate(${currentRotation}deg)`;

            setTimeout(() => {
                const finalRotation = (currentRotation % 360) * -1;
                let resultNumber;

                if (finalRotation >= 0 && finalRotation < 216) {
                    resultNumber = 1;
                } else if (finalRotation >= 216 && finalRotation < 324) {
                    resultNumber = 2;
                } else {
                    resultNumber = 3;
                }

                result.textContent = `‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ${resultNumber}`;
                isSpinning = false;
                spinBtn.disabled = false;
            }, 1500); // ‡πÄ‡∏ß‡∏•‡∏≤ 1500
        }

        spinBtn.addEventListener('click', spinWheel);
        wheel.addEventListener('click', spinWheel);
    </script>

    <script>
        const TYPES = ["GOOD", "BAD", "CHANCE", "MONEY +1", "DUEL", "GAMBLE", "blank"];

        const layout = [
            ["blank",    "BAD",    "CHANCE",   "blank", "BAD",    "blank",  "CHANCE"],
            ["DUEL",     "blank",  null,       "blank", "blank",  null,     "MONEY +1"],
            ["blank",    "GOOD",   "blank",    "START", "blank",  "CHANCE", "blank"],
            ["MONEY +1", "CHANCE", "MONEY +1", "blank", "GAMBLE", null,     "CHANCE"],
            ["CHANCE",   null,     "blank",    "GOOD",  "blank",  "CHANCE", "MONEY +1"]
        ];

        const board = document.getElementById("game-board");
        const lines = document.getElementById("lines");

        const positions = {};

        let cellNumber = 1;

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á cell ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡πà‡∏≠‡∏ô
        layout.forEach((row, y) => {
            row.forEach((type, x) => {
                if (type === null) {
                    // ‡∏ä‡πà‡∏≠‡∏á null: ‡πÄ‡∏ß‡πâ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á
                    const emptyDiv = document.createElement("div");
                    emptyDiv.className = "w-28 h-20 opacity-0 pointer-events-none";
                    board.appendChild(emptyDiv);
                    return;
                }

                const div = document.createElement("div");
                div.className = "cell flex items-center justify-center border border-gray-400 rounded-md w-28 h-20 text-xs font-semibold text-center select-none transition hover:bg-gray-100 cursor-pointer relative";

                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
                if (type === "blank") {
                    div.classList.add("bg-gray-300");
                } else if (type === "CHANCE") {
                    div.classList.add("bg-purple-300");
                } else if (type === "MONEY +1") {
                    div.classList.add("bg-yellow-200");
                } else if (type === "BAD") {
                    div.classList.add("bg-gradient-to-r", "from-red-400", "to-orange-400");
                } else if (type === "DUEL") {
                    div.classList.add("bg-gradient-to-r", "from-black", "to-blue-900");
                } else if (type === "GOOD") {
                    div.classList.add("bg-gradient-to-r", "from-yellow-300", "to-sky-300");
                } else if (type === "GAMBLE") {
                    div.classList.add("bg-gradient-to-r", "from-pink-400", "to-yellow-300");
                } else {
                    div.classList.add("bg-white");
                }

                div.dataset.row = y;
                div.dataset.col = x;

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á span ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å
                const typeSpan = document.createElement("span");
                typeSpan.className = "cell-type";
                typeSpan.textContent = type === "blank" ? "" : type;
                // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö DUEL
                if (type === "DUEL") {
                    typeSpan.classList.add("text-white");
                }
                div.appendChild(typeSpan);

                const id = `${y}-${x}`;
                positions[id] = { x, y };

                // ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ä‡πà‡∏≠‡∏á START, DUEL, GAMBLE ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏•‡∏Ç
                if (type === "START") {
                    div.classList.add("bg-white", "font-bold");
                } else {
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏Ç‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á
                    const numSpan = document.createElement("span");
                    numSpan.textContent = cellNumber;
                    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô DUEL ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏Ç‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß
                    numSpan.className = `absolute bottom-1 right-2 text-[10px] ${type === "DUEL" ? "text-white" : "text-black"}`;
                    div.appendChild(numSpan);
                    cellNumber++;
                }

                if (type !== "START") {
                    // ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ä‡πà‡∏≠‡∏á
                    div.addEventListener("contextmenu", (e) => {
                        e.preventDefault();

                        // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ select ‡πÄ‡∏î‡∏¥‡∏°‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏•‡∏ö‡∏Å‡πà‡∏≠‡∏ô
                        const oldSelect = div.querySelector("select.cell-type-select");
                        if (oldSelect) oldSelect.remove();

                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á select
                        const select = document.createElement("select");
                        select.className = "cell-type-select absolute bottom-1 left-1 text-xs bg-white border rounded shadow z-20";
                        TYPES.forEach(optType => {
                            if (optType === "START") return; // ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å START
                            const option = document.createElement("option");
                            option.value = optType;
                            option.textContent = optType === "blank" ? "(blank)" : optType;
                            if ((typeSpan.textContent === "" && optType === "blank") || typeSpan.textContent === optType) {
                                option.selected = true;
                            }
                            select.appendChild(option);
                        });

                        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ä‡πà‡∏≠‡∏á
                        select.addEventListener("change", () => {
                            const next = select.value;
                            typeSpan.textContent = next === "blank" ? "" : next;

                            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° DUEL
                            typeSpan.classList.remove("text-white");
                            if (next === "DUEL") typeSpan.classList.add("text-white");

                            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
                            div.classList.remove(
                                "bg-gray-300", "bg-purple-300", "bg-yellow-200", "bg-white",
                                "bg-gradient-to-br", "bg-gradient-to-r",
                                "from-red-400", "to-orange-400",
                                "from-black", "to-blue-900",
                                "from-yellow-300", "to-sky-300",
                                "from-pink-400", "to-yellow-300"
                            );
                            if (next === "blank") {
                                div.classList.add("bg-gray-300");
                            } else if (next === "CHANCE") {
                                div.classList.add("bg-purple-300");
                            } else if (next === "MONEY +1") {
                                div.classList.add("bg-yellow-200");
                            } else if (next === "BAD") {
                                div.classList.add("bg-gradient-to-r", "from-red-400", "to-orange-400");
                            } else if (next === "DUEL") {
                                div.classList.add("bg-gradient-to-r", "from-black", "to-blue-900");
                            } else if (next === "GOOD") {
                                div.classList.add("bg-gradient-to-r", "from-yellow-300", "to-sky-300");
                            } else if (next === "GAMBLE") {
                                div.classList.add("bg-gradient-to-r", "from-pink-400", "to-yellow-300");
                            } else {
                                div.classList.add("bg-white");
                            }

                            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
                            const numSpan = div.querySelector("span:not(.cell-type)");
                            numSpan.classList.remove("text-white", "text-black");
                            if (next === "DUEL") {
                                numSpan.classList.add("text-white");
                            } else {
                                numSpan.classList.add("text-black");
                            }

                            select.remove();
                        });

                        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ select ‡πÄ‡∏™‡∏µ‡∏¢ focus ‡πÉ‡∏´‡πâ‡∏•‡∏ö
                        select.addEventListener("blur", () => select.remove());

                        div.appendChild(select);
                        select.focus();
                    });
                }

                board.appendChild(div);
            });
        });

        // Define paths between tiles (manually based on visual layout)
        const paths = [
            [[0, 0], [0, 6]], [[0, 0], [2, 0]], [[0, 1], [3, 1]], [[1, 0], [1, 1]], [[2, 0], [2, 6]],
            [[3, 0], [4, 0]], [[3, 0], [3, 4]], [[3, 2], [4, 2]], [[4, 2], [4, 6]], [[0, 3], [4, 3]], 
            [[0, 4], [4, 4]], [[0, 6], [4, 6]]
        ];

        function drawLine(x1, y1, x2, y2) {
            // ‡∏´‡∏≤ cell ‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á
            const fromCell = document.querySelector(`.cell[data-row="${y1}"][data-col="${x1}"]`);
            const toCell = document.querySelector(`.cell[data-row="${y2}"][data-col="${x2}"]`);
            if (!fromCell || !toCell) return;

            // ‡∏´‡∏≤ offset ‡∏Ç‡∏≠‡∏á game-board
            const boardRect = board.getBoundingClientRect();

            // ‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á cell ‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á
            const fromRect = fromCell.getBoundingClientRect();
            const p1x = fromRect.left - boardRect.left + fromRect.width / 2;
            const p1y = fromRect.top - boardRect.top + fromRect.height / 2;

            // ‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á cell ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á
            const toRect = toCell.getBoundingClientRect();
            const p2x = toRect.left - boardRect.left + toRect.width / 2;
            const p2y = toRect.top - boardRect.top + toRect.height / 2;

            const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
            line.setAttribute("x1", p1x);
            line.setAttribute("y1", p1y);
            line.setAttribute("x2", p2x);
            line.setAttribute("y2", p2y);
            line.setAttribute("stroke", "#888");
            line.setAttribute("stroke-width", "3");
            line.setAttribute("stroke-linecap", "round");
            lines.appendChild(line);
        }

        // ‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á DOM render ‡πÅ‡∏•‡πâ‡∏ß
        setTimeout(() => {
            paths.forEach(([from, to]) => drawLine(from[1], from[0], to[1], to[0]));
        }, 0);

        // ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á Game Board ‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
        window.addEventListener('DOMContentLoaded', () => {
            const gameBoard = document.getElementById('game-board');
            const addPlayerDiv = document.getElementById('add-player-buttons');

            setTimeout(() => {
                const boardRect = gameBoard.getBoundingClientRect();
                const boardHeight = boardRect.height;

                const btnCount = 4;
                const btnGap = 16;
                const btnSize = (boardHeight - btnGap * (btnCount - 1)) / btnCount;

                addPlayerDiv.style.height = boardHeight + "px";
                addPlayerDiv.innerHTML = "";

                for (let i = 0; i < btnCount; i++) {
                    const btn = document.createElement("button");
                    btn.type = "button";
                    btn.className = `add-player-btn flex items-center justify-center rounded-full bg-orange-400 hover:bg-orange-500 shadow w-[${btnSize}px] h-[${btnSize}px] text-white text-3xl transition-all`;
                    btn.style.width = btn.style.height = btnSize + "px";
                    btn.innerHTML = '<span class="pointer-events-none select-none">+</span>';
                    btn.title = "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô";
                    btn.dataset.index = i;
                    addPlayerDiv.appendChild(btn);
                    if (i < btnCount - 1) {
                        const gap = document.createElement("div");
                        gap.style.height = btnGap + "px";
                        addPlayerDiv.appendChild(gap);
                    }
                }

                // Dummy left space
                const leftSpace = document.getElementById('left-space');
                leftSpace.style.height = boardHeight + "px";
                leftSpace.innerHTML = "";
                for (let i = 0; i < btnCount; i++) {
                    const dummy = document.createElement("div");
                    dummy.className = `rounded-full w-[${btnSize}px] h-[${btnSize}px] opacity-0`;
                    dummy.style.width = dummy.style.height = btnSize + "px";
                    leftSpace.appendChild(dummy);
                    if (i < btnCount - 1) {
                        const gap = document.createElement("div");
                        gap.style.height = btnGap + "px";
                        leftSpace.appendChild(gap);
                    }
                }

                // Modal logic
                const modalBg = document.getElementById('player-modal-bg');
                const closeModal = document.getElementById('close-modal');
                const playerForm = document.getElementById('player-form');
                const playerImgInput = document.getElementById('player-img');
                const playerBorderInput = document.getElementById('player-border');
                let currentBtn = null;

                // ‡πÄ‡∏õ‡∏¥‡∏î modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
                function bindAddPlayerBtnEvents() {
                    document.querySelectorAll('.add-player-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            currentBtn = btn;
                            playerForm.reset();
                            playerBorderInput.value = "#f97316";
                            modalBg.classList.remove('hidden');
                        });
                    });
                }
                bindAddPlayerBtnEvents();

                // ‡∏õ‡∏¥‡∏î modal
                closeModal.addEventListener('click', () => {
                    modalBg.classList.add('hidden');
                });
                modalBg.addEventListener('click', (e) => {
                    if (e.target === modalBg) modalBg.classList.add('hidden');
                });

                // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ submit ‡∏ü‡∏≠‡∏£‡πå‡∏°
                playerForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    if (!currentBtn) return;
                    const imgUrl = playerImgInput.value;
                    const borderColor = playerBorderInput.value;

                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏ó‡∏ô‡∏õ‡∏∏‡πà‡∏°
                    const img = document.createElement('img');
                    img.src = imgUrl;
                    img.alt = "Player";
                    img.className = "player-img rounded-full object-cover cursor-pointer";
                    img.style.width = img.style.height = currentBtn.style.width;
                    img.style.border = `4px solid ${borderColor}`;
                    img.style.background = "#fff";
                    img.style.boxShadow = "0 2px 8px rgba(0,0,0,0.15)";
                    img.dataset.index = currentBtn.dataset.index;

                    // ‡πÄ‡∏û‡∏¥‡πà‡∏° contextmenu ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏ö
                    img.addEventListener('contextmenu', function(e) {
                        e.preventDefault();
                        // ‡∏•‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏î‡∏¥‡∏°‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
                        document.querySelectorAll('.player-context-menu').forEach(m => m.remove());

                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏ô‡∏π
                        const menu = document.createElement('div');
                        menu.className = "player-context-menu absolute bg-white border rounded shadow px-3 py-2 text-sm z-50";
                        menu.style.top = e.clientY + "px";
                        menu.style.left = e.clientX + "px";
                        menu.innerHTML = `<button class="text-red-600 hover:underline" type="button">‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</button>`;

                        // ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î
                        menu.querySelector('button').addEventListener('click', () => {
                            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏ó‡∏ô img
                            const newBtn = document.createElement("button");
                            newBtn.type = "button";
                            newBtn.className = `add-player-btn flex items-center justify-center rounded-full bg-orange-400 hover:bg-orange-500 shadow w-[${img.style.width}] h-[${img.style.height}] text-white text-3xl transition-all`;
                            newBtn.style.width = newBtn.style.height = img.style.width;
                            newBtn.innerHTML = '<span class="pointer-events-none select-none">+</span>';
                            newBtn.title = "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô";
                            newBtn.dataset.index = img.dataset.index;
                            img.replaceWith(newBtn);
                            bindAddPlayerBtnEvents();
                            menu.remove();
                        });

                        // ‡∏•‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏∑‡πà‡∏ô
                        document.body.addEventListener('click', function removeMenu(ev) {
                            if (!menu.contains(ev.target)) {
                                menu.remove();
                                document.body.removeEventListener('click', removeMenu);
                            }
                        });

                        document.body.appendChild(menu);
                    });

                    currentBtn.replaceWith(img);

                    modalBg.classList.add('hidden');
                    currentBtn = null;
                });
            }, 0);
        });
    </script>

    <!-- Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô -->
    <div id="player-modal-bg" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-lg p-6 w-80 relative">
            <button id="close-modal" class="absolute top-2 right-2 text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            <h2 class="text-lg font-bold mb-4 text-orange-600">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h2>
            <form id="player-form" class="flex flex-col gap-4">
                <div>
                    <label class="block text-sm font-medium mb-1">‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</label>
                    <input type="url" id="player-img" class="w-full border rounded px-2 py-1" placeholder="https://..." required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ‡∏Ç‡∏≠‡∏ö‡∏£‡∏π‡∏õ</label>
                    <input type="color" id="player-border" class="w-10 h-10 p-0 border-2 rounded-full" value="#f97316">
                </div>
                <button type="submit" class="bg-orange-500 hover:bg-orange-600 text-white rounded px-4 py-2 font-bold">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
            </form>
        </div>
    </div>
</body>

</html>