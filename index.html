<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game Board</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css" />
</head>

<body class="bg-gray-100 min-h-screen flex flex-col items-center p-6 pt-10">

    <!-- Navbar ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤ -->
    <nav class="w-full flex items-center justify-between px-6 py-3 bg-white shadow mb-6 fixed top-0 left-0 z-50">
        <!-- ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏£‡∏π‡∏õ‡∏™‡πâ‡∏° (‡πÉ‡∏ä‡πâ emoji) -->
        <div class="flex items-center gap-2">
            <span class="text-3xl">üçä</span>
            <span class="font-bold text-xl text-orange-600">‡πÄ‡∏Å‡∏°‡∏™‡πâ‡∏°</span>
        </div>
        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤: How To Play ‡πÅ‡∏•‡∏∞ Save/Load -->
        <div class="flex items-center gap-2">
            <button id="saveBtn"
                class="bg-green-500 hover:bg-green-600 text-white font-semibold px-4 py-2 rounded shadow transition">Save</button>
            <label for="loadFile"
                class="bg-blue-500 hover:bg-blue-600 text-white font-semibold px-4 py-2 rounded shadow transition cursor-pointer">
                Load
                <input type="file" id="loadFile" accept=".json" class="hidden" />
            </label>
            <a href="https://www.youtube.com/live/TTaur_JfrCs?si=K-lf_ghMbp22_hwj" target="_blank"
                class="bg-orange-500 hover:bg-orange-600 text-white font-semibold px-4 py-2 rounded shadow transition">
                How To Play
            </a>
        </div>
    </nav>

    <!-- Sidebar ‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ -->
    <aside id="sidebar"
        class="fixed top-16 left-0 w-64 h-full bg-white shadow z-40 flex flex-col items-start p-4 gap-3 border-r border-gray-200 transform -translate-x-full transition-transform duration-300">
        <!-- ‡∏õ‡∏∏‡πà‡∏° ‚ò∞ -->
        <button id="toggleSidebar" onclick="sidebar()"
            class="absolute -right-9 top-4 bg-white border-r border-gray-300 text-gray-700 px-3 py-1 rounded-r z-40">
            ‚ò∞
        </button>
        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡πà‡∏≤‡∏á ‡πÜ -->
        <button id="btnPageBoard" onclick="changePageBoard()"
            class="w-full text-left px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-300 transition">
            üé≤ ‡πÄ‡∏Å‡∏°‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô
        </button>
        <button id="btnPageChar" onclick="changePageChar()"
            class="w-full text-left px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400 transition">
            üßç‚Äç‚ôÄÔ∏è ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£
        </button>
        <button id="btnPageShop" onclick="changePageShop()"
            class="w-full text-left px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400 transition">
            üè™ ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤
        </button>
    </aside>

    <!-- game-board-space -->
    <div id="game-board-space">
        <!-- ‡∏Ç‡∏¢‡∏±‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏•‡∏á‡∏°‡∏≤‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ö Navbar -->
        <div class="pt-16"></div>

        <svg id="special-lines" class="absolute top-0 left-0 w-full h-full pointer-events-none z-0"
            style="overflow: visible;"></svg>

        <!-- Game Board + ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤ -->
        <div class="relative flex flex-row items-start justify-center w-full">
            <!-- ‡∏î‡∏±‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ Game Board ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á -->
            <div id="left-space" class="flex flex-col justify-between items-center mr-16" style="height: 100%;">
            </div>
            <!-- Game Board -->
            <div class="relative" id="game-wrapper">
                <svg class="absolute top-0 left-0 w-full h-full pointer-events-none z-0" id="lines"></svg>
                <div class="grid grid-cols-7 gap-4 relative z-10" id="game-board"></div>
            </div>
            <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 4 ‡∏õ‡∏∏‡πà‡∏° -->
            <div id="add-player-buttons" class="flex flex-col justify-between items-center ml-16" style="height: 100%;">
                <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ JS ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö Game Board -->
            </div>
        </div>

        <!-- ‡∏ß‡∏á‡∏•‡πâ‡∏≠ -->
        <div class="relative flex flex-col items-center gap-5 mt-3">
            <!-- ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå -->
            <div id="result" class="text-xl font-bold text-[#333] text-center min-h-[30px]"></div>

            <!-- Wheel (conic-gradient) -->
            <div class="relative w-[300px] h-[300px]">
                <!-- Pointer -->
                <div
                    class="absolute -top-2 left-1/2 -translate-x-1/2 w-0 h-0 border-l-[15px] border-l-transparent border-r-[15px] border-r-transparent border-t-[20px] border-t-[#333] z-10">
                </div>
                <div id="wheel"
                    class="w-full h-full rounded-full shadow-[0_10px_30px_rgba(0,0,0,0.3)] transition-transform duration-[1500ms] ease-[cubic-bezier(0.25,0.1,0.25,1)] border-4 border-white cursor-pointer"
                    style="background: conic-gradient(
                         from 0deg,
                         #FF5722 0deg 216deg,
                         #FF9800 216deg 324deg,
                         #FFC107 324deg 360deg
                     );">
                    <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô -->
                    <div class="absolute inset-0 flex items-center justify-center">
                        <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1 -->
                        <div class="absolute text-white font-bold text-5xl"
                            style="transform: rotate(108deg) translateY(-100px) rotate(-108deg);">1</div>
                        <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2 -->
                        <div class="absolute text-white font-bold text-5xl"
                            style="transform: rotate(270deg) translateY(-100px) rotate(-270deg);">2</div>
                        <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3 -->
                        <div class="absolute text-white font-bold text-5xl"
                            style="transform: rotate(342deg) translateY(-100px) rotate(-342deg);">3</div>
                    </div>
                </div>
                <!-- Spin Button -->
                <button id="spinBtn"
                    class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-20 h-20 rounded-full bg-[#333] z-10 pointer-events-none">
                </button>
            </div>
        </div>
    </div>

    <!-- character-space -->
    <div id="character-space" class="hidden pt-14 px-4 w-full h-screen grid grid-cols-4 gap-4 max-w-8xl mx-auto">
        <!-- ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 1 -->
        <div class="flex flex-col items-center bg-white rounded-2xl shadow-lg px-4 py-6 space-y-4">
            <img src="" class="w-24 h-24 rounded-full border-4 border-orange-400 object-cover shadow mb-2" />
            <div class="text-center space-y-3 w-full">
                <!-- GOLD Section -->
                <div class="bg-yellow-100 rounded-xl p-4 shadow-inner">
                    <div class="flex items-center justify-center gap-2">
                        <button
                            class="gold-minus bg-red-500 hover:bg-red-600 text-white w-8 h-8 rounded-full text-sm font-bold">-</button>
                        <div class="font-bold text-yellow-600 text-lg">GOLD: <span class="gold-count">0</span></div>
                        <button
                            class="gold-plus bg-green-500 hover:bg-green-600 text-white w-8 h-8 rounded-full text-sm font-bold">+</button>
                    </div>
                </div>
                <!-- Orange Section -->
                <div class="bg-orange-100 rounded-xl p-4 shadow-inner">
                    <div class="flex items-center justify-center gap-2">
                        <button
                            class="orange-minus bg-red-500 hover:bg-red-600 text-white w-8 h-8 rounded-full text-sm font-bold">-</button>
                        <div class="text-orange-600 text-md font-semibold">‡∏™‡πâ‡∏°: <span class="orange-count">0</span>
                        </div>
                        <button
                            class="orange-plus bg-green-500 hover:bg-green-600 text-white w-8 h-8 rounded-full text-sm font-bold">+</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 2 -->
        <div class="flex flex-col items-center bg-gray-100 rounded-2xl shadow-lg px-4 py-6 space-y-4">
            <img src="" class="w-24 h-24 rounded-full border-4 border-orange-400 object-cover shadow mb-2" />
            <div class="text-center space-y-3 w-full">
                <!-- GOLD Section -->
                <div class="bg-yellow-100 rounded-xl p-4 shadow-inner">
                    <div class="flex items-center justify-center gap-2">
                        <button
                            class="gold-minus bg-red-500 hover:bg-red-600 text-white w-8 h-8 rounded-full text-sm font-bold">-</button>
                        <div class="font-bold text-yellow-600 text-lg">GOLD: <span class="gold-count">0</span></div>
                        <button
                            class="gold-plus bg-green-500 hover:bg-green-600 text-white w-8 h-8 rounded-full text-sm font-bold">+</button>
                    </div>
                </div>
                <!-- Orange Section -->
                <div class="bg-orange-100 rounded-xl p-4 shadow-inner">
                    <div class="flex items-center justify-center gap-2">
                        <button
                            class="orange-minus bg-red-500 hover:bg-red-600 text-white w-8 h-8 rounded-full text-sm font-bold">-</button>
                        <div class="text-orange-600 text-md font-semibold">‡∏™‡πâ‡∏°: <span class="orange-count">0</span>
                        </div>
                        <button
                            class="orange-plus bg-green-500 hover:bg-green-600 text-white w-8 h-8 rounded-full text-sm font-bold">+</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 3 -->
        <div class="flex flex-col items-center bg-white rounded-2xl shadow-lg px-4 py-6 space-y-4">
            <img src="" class="w-24 h-24 rounded-full border-4 border-orange-400 object-cover shadow mb-2" />
            <div class="text-center space-y-3 w-full">
                <!-- GOLD Section -->
                <div class="bg-yellow-100 rounded-xl p-4 shadow-inner">
                    <div class="flex items-center justify-center gap-2">
                        <button
                            class="gold-minus bg-red-500 hover:bg-red-600 text-white w-8 h-8 rounded-full text-sm font-bold">-</button>
                        <div class="font-bold text-yellow-600 text-lg">GOLD: <span class="gold-count">0</span></div>
                        <button
                            class="gold-plus bg-green-500 hover:bg-green-600 text-white w-8 h-8 rounded-full text-sm font-bold">+</button>
                    </div>
                </div>
                <!-- Orange Section -->
                <div class="bg-orange-100 rounded-xl p-4 shadow-inner">
                    <div class="flex items-center justify-center gap-2">
                        <button
                            class="orange-minus bg-red-500 hover:bg-red-600 text-white w-8 h-8 rounded-full text-sm font-bold">-</button>
                        <div class="text-orange-600 text-md font-semibold">‡∏™‡πâ‡∏°: <span class="orange-count">0</span>
                        </div>
                        <button
                            class="orange-plus bg-green-500 hover:bg-green-600 text-white w-8 h-8 rounded-full text-sm font-bold">+</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 4 -->
        <div class="flex flex-col items-center bg-gray-100 rounded-2xl shadow-lg px-4 py-6 space-y-4">
            <img src="" class="w-24 h-24 rounded-full border-4 border-orange-400 object-cover shadow mb-2" />
            <div class="text-center space-y-3 w-full">
                <!-- GOLD Section -->
                <div class="bg-yellow-100 rounded-xl p-4 shadow-inner">
                    <div class="flex items-center justify-center gap-2">
                        <button
                            class="gold-minus bg-red-500 hover:bg-red-600 text-white w-8 h-8 rounded-full text-sm font-bold">-</button>
                        <div class="font-bold text-yellow-600 text-lg">GOLD: <span class="gold-count">0</span></div>
                        <button
                            class="gold-plus bg-green-500 hover:bg-green-600 text-white w-8 h-8 rounded-full text-sm font-bold">+</button>
                    </div>
                </div>
                <!-- Orange Section -->
                <div class="bg-orange-100 rounded-xl p-4 shadow-inner">
                    <div class="flex items-center justify-center gap-2">
                        <button
                            class="orange-minus bg-red-500 hover:bg-red-600 text-white w-8 h-8 rounded-full text-sm font-bold">-</button>
                        <div class="text-orange-600 text-md font-semibold">‡∏™‡πâ‡∏°: <span class="orange-count">0</span>
                        </div>
                        <button
                            class="orange-plus bg-green-500 hover:bg-green-600 text-white w-8 h-8 rounded-full text-sm font-bold">+</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô -->
    <div id="player-modal-bg" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-lg p-6 w-120 relative">
            <button id="close-modal"
                class="absolute top-2 right-2 text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            <h2 class="text-lg font-bold mb-4 text-orange-600">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h2>
            <form id="player-form" class="flex flex-col gap-4">
                <div>
                    <label class="block text-sm font-medium mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô</label>
                    <div class="flex gap-3">
                        <label class="flex items-center gap-1">
                            <input type="radio" name="icon-type" value="url" checked>
                            URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
                        </label>
                        <label class="flex items-center gap-1">
                            <input type="radio" name="icon-type" value="text">
                            ‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥ / ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                        </label>
                        <label class="flex items-center gap-1">
                            <input type="radio" name="icon-type" value="upload">
                            ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
                        </label>
                    </div>
                </div>

                <div id="url-input-wrapper">
                    <label class="block text-sm font-medium mb-1 mt-2">‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</label>
                    <input type="url" id="player-img" class="w-full border rounded px-2 py-1" placeholder="https://...">
                </div>

                <div id="text-input-wrapper" class="hidden">
                    <label class="block text-sm font-medium mb-1 mt-2">‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</label>
                    <input type="text" id="player-text" maxlength="3" class="w-full border rounded px-2 py-1"
                        placeholder="üçâ ‡∏´‡∏£‡∏∑‡∏≠ A">
                </div>

                <div id="upload-input-wrapper" class="hidden">
                    <label class="block text-sm font-medium mb-1 mt-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</label>
                    <input type="file" id="player-upload" accept="image/*" class="w-full border rounded px-2 py-1">
                </div>

                <div>
                    <label class="block text-sm font-medium mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ‡∏Ç‡∏≠‡∏ö‡∏£‡∏π‡∏õ</label>
                    <input type="color" id="player-border" value="#f97316">
                </div>
                <button type="submit"
                    class="bg-orange-500 hover:bg-orange-600 text-white rounded px-4 py-2 font-bold">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
            </form>
        </div>
    </div>

    <script>
        let isSpinning = false;
        let currentRotation = 0;

        const wheel = document.getElementById('wheel');
        const spinBtn = document.getElementById('spinBtn');
        const result = document.getElementById('result');

        function spinWheel() {
            if (isSpinning) return;

            isSpinning = true;
            spinBtn.disabled = true;
            result.textContent = '';

            const randomRotation = Math.floor(Math.random() * 1800) + 700; // ‡∏´‡∏°‡∏∏‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 700 ‡∏ñ‡∏∂‡∏á 2500 ‡∏≠‡∏á‡∏®‡∏≤
            currentRotation -= randomRotation;

            wheel.style.transform = `rotate(${currentRotation}deg)`;

            setTimeout(() => {
                const finalRotation = (currentRotation % 360) * -1;
                let resultNumber;

                if (finalRotation >= 0 && finalRotation < 216) {
                    resultNumber = 1;
                } else if (finalRotation >= 216 && finalRotation < 324) {
                    resultNumber = 2;
                } else {
                    resultNumber = 3;
                }

                result.textContent = `‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ${resultNumber}`;
                isSpinning = false;
                spinBtn.disabled = false;
            }, 1500); // ‡πÄ‡∏ß‡∏•‡∏≤ 1500
        }

        spinBtn.addEventListener('click', spinWheel);
        wheel.addEventListener('click', spinWheel);
    </script>

    <script>
        const TYPES = ["GOOD", "BAD", "CHANCE", "MONEY +1", "DUEL", "GAMBLE", "blank"];

        let layout = [
            ["blank", "BAD", "CHANCE", "blank", "BAD", "blank", "CHANCE"],
            ["DUEL", "blank", null, "blank", "blank", null, "MONEY +1"],
            ["blank", "GOOD", "blank", "START", "blank", "CHANCE", "blank"],
            ["MONEY +1", "CHANCE", "MONEY +1", "blank", "GAMBLE", null, "CHANCE"],
            ["CHANCE", null, "blank", "GOOD", "blank", "CHANCE", "MONEY +1"]
        ];

        const board = document.getElementById("game-board");
        const lines = document.getElementById("lines");

        const positions = {};

        let cellNumber = 1;

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á cell ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡πà‡∏≠‡∏ô
        layout.forEach((row, y) => {
            row.forEach((type, x) => {
                if (type === null) {
                    // ‡∏ä‡πà‡∏≠‡∏á null: ‡πÄ‡∏ß‡πâ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á
                    const emptyDiv = document.createElement("div");
                    emptyDiv.className = "w-28 h-20 opacity-0 pointer-events-none";
                    board.appendChild(emptyDiv);
                    return;
                }

                const div = document.createElement("div");
                div.className = "cell flex items-center justify-center border border-gray-400 rounded-md w-28 h-20 text-xs font-semibold text-center select-none transition hover:bg-gray-100 cursor-pointer relative";

                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
                if (type === "blank") {
                    div.classList.add("bg-gray-300");
                } else if (type === "CHANCE") {
                    div.classList.add("bg-purple-300");
                } else if (type === "MONEY +1") {
                    div.classList.add("bg-yellow-200");
                } else if (type === "BAD") {
                    div.classList.add("bg-gradient-to-r", "from-red-400", "to-orange-400");
                } else if (type === "DUEL") {
                    div.classList.add("bg-gradient-to-r", "from-black", "to-blue-900");
                } else if (type === "GOOD") {
                    div.classList.add("bg-gradient-to-r", "from-yellow-300", "to-sky-300");
                } else if (type === "GAMBLE") {
                    div.classList.add("bg-gradient-to-r", "from-pink-400", "to-yellow-300");
                } else {
                    div.classList.add("bg-white");
                }

                div.dataset.row = y;
                div.dataset.col = x;

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á span ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å
                const typeSpan = document.createElement("span");
                typeSpan.className = "cell-type";
                typeSpan.textContent = type === "blank" ? "" : type;
                // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö DUEL
                if (type === "DUEL") {
                    typeSpan.classList.add("text-white");
                }
                div.appendChild(typeSpan);

                const id = `${y}-${x}`;
                positions[id] = { x, y };

                // ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ä‡πà‡∏≠‡∏á START ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏•‡∏Ç
                if (type === "START") {
                    div.classList.add("bg-white", "font-bold");
                } else {
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏Ç‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á
                    const numSpan = document.createElement("span");
                    numSpan.textContent = cellNumber;
                    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô DUEL ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏Ç‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß
                    numSpan.className = `absolute bottom-1 right-2 text-[10px] ${type === "DUEL" ? "text-white" : "text-black"}`;
                    div.appendChild(numSpan);
                    cellNumber++;
                }

                if (type !== "START") {
                    // ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ä‡πà‡∏≠‡∏á
                    div.addEventListener("contextmenu", (e) => {
                        e.preventDefault();

                        // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ select ‡πÄ‡∏î‡∏¥‡∏°‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏•‡∏ö‡∏Å‡πà‡∏≠‡∏ô
                        const oldSelect = div.querySelector("select.cell-type-select");
                        if (oldSelect) oldSelect.remove();

                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á select
                        const select = document.createElement("select");
                        select.className = "cell-type-select absolute bottom-1 left-1 text-xs bg-white border rounded shadow z-20";
                        TYPES.forEach(optType => {
                            if (optType === "START") return; // ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å START
                            const option = document.createElement("option");
                            option.value = optType;
                            option.textContent = optType === "blank" ? "(blank)" : optType;
                            if ((typeSpan.textContent === "" && optType === "blank") || typeSpan.textContent === optType) {
                                option.selected = true;
                            }
                            select.appendChild(option);
                        });

                        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ä‡πà‡∏≠‡∏á
                        select.addEventListener("change", () => {
                            const next = select.value;
                            loadLayout(next, div, typeSpan);
                            select.remove();
                        });

                        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ select ‡πÄ‡∏™‡∏µ‡∏¢ focus ‡πÉ‡∏´‡πâ‡∏•‡∏ö
                        select.addEventListener("blur", () => select.remove());

                        div.appendChild(select);
                        select.focus();
                    });
                }

                board.appendChild(div);
            });
        });

        function loadLayout(next, div, typeSpan) {
            typeSpan.textContent = next === "blank" ? "" : next;

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï layout array
            layout[parseInt(div.dataset.row)][parseInt(div.dataset.col)] = next;

            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° DUEL
            typeSpan.classList.remove("text-white");
            if (next === "DUEL") typeSpan.classList.add("text-white");

            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
            div.classList.remove(
                "bg-gray-300", "bg-purple-300", "bg-yellow-200", "bg-white",
                "bg-gradient-to-br", "bg-gradient-to-r",
                "from-red-400", "to-orange-400",
                "from-black", "to-blue-900",
                "from-yellow-300", "to-sky-300",
                "from-pink-400", "to-yellow-300"
            );
            if (next === "blank") {
                div.classList.add("bg-gray-300");
            } else if (next === "CHANCE") {
                div.classList.add("bg-purple-300");
            } else if (next === "MONEY +1") {
                div.classList.add("bg-yellow-200");
            } else if (next === "BAD") {
                div.classList.add("bg-gradient-to-r", "from-red-400", "to-orange-400");
            } else if (next === "DUEL") {
                div.classList.add("bg-gradient-to-r", "from-black", "to-blue-900");
            } else if (next === "GOOD") {
                div.classList.add("bg-gradient-to-r", "from-yellow-300", "to-sky-300");
            } else if (next === "GAMBLE") {
                div.classList.add("bg-gradient-to-r", "from-pink-400", "to-yellow-300");
            } else {
                div.classList.add("bg-white");
            }

            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
            const numSpan = div.querySelector("span:not(.cell-type)");
            if (numSpan) {
                numSpan.classList.remove("text-white", "text-black");
                if (next === "DUEL") {
                    numSpan.classList.add("text-white");
                } else {
                    numSpan.classList.add("text-black");
                }
            }
        }

        // Define paths between tiles (manually based on visual layout)
        const paths = [
            [[0, 0], [0, 6]], [[0, 0], [2, 0]], [[0, 1], [3, 1]], [[1, 0], [1, 1]], [[2, 0], [2, 6]],
            [[3, 0], [4, 0]], [[3, 0], [3, 4]], [[3, 2], [4, 2]], [[4, 2], [4, 6]], [[0, 3], [4, 3]],
            [[0, 4], [4, 4]], [[0, 6], [4, 6]]
        ];

        function drawSpecialLine(x, y, directionX, directionY, color, side) {
            const fromCell = document.querySelector(`.cell[data-row="${x}"][data-col="${y}"]`);
            if (!fromCell) return;

            const fromRect = fromCell.getBoundingClientRect();

            let p1x, p1y;

            if (side === "left") {
                p1x = fromRect.left;
                p1y = fromRect.top + fromRect.height / 2;
            } else if (side === "right") {
                p1x = fromRect.right;
                p1y = fromRect.top + fromRect.height / 2;
            } else if (side === "top") {
                p1x = fromRect.left + fromRect.width / 2;
                p1y = fromRect.top;
            } else if (side === "bottom") {
                p1x = fromRect.left + fromRect.width / 2;
                p1y = fromRect.bottom;
            }

            const p2x = p1x + directionX;
            const p2y = p1y + directionY;

            const overlaySvg = document.getElementById('special-lines');
            if (!overlaySvg) return;

            const specialLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
            specialLine.setAttribute("x1", p1x);
            specialLine.setAttribute("y1", p1y);
            specialLine.setAttribute("x2", p2x);
            specialLine.setAttribute("y2", p2y);
            specialLine.setAttribute("stroke", color);
            specialLine.setAttribute("stroke-width", "4");
            specialLine.setAttribute("stroke-linecap", "round");

            // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏™‡πâ‡∏ô‡∏õ‡∏£‡∏∞
            specialLine.setAttribute("stroke-dasharray", "8, 10");

            overlaySvg.appendChild(specialLine);
        }

        function drawLine(x1, y1, x2, y2) {
            // ‡∏´‡∏≤ cell ‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á
            const fromCell = document.querySelector(`.cell[data-row="${y1}"][data-col="${x1}"]`);
            const toCell = document.querySelector(`.cell[data-row="${y2}"][data-col="${x2}"]`);
            if (!fromCell || !toCell) return;

            // ‡∏´‡∏≤ offset ‡∏Ç‡∏≠‡∏á game-board
            const boardRect = board.getBoundingClientRect();

            // ‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á cell ‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á
            const fromRect = fromCell.getBoundingClientRect();
            const p1x = fromRect.left - boardRect.left + fromRect.width / 2;
            const p1y = fromRect.top - boardRect.top + fromRect.height / 2;

            // ‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á cell ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á
            const toRect = toCell.getBoundingClientRect();
            const p2x = toRect.left - boardRect.left + toRect.width / 2;
            const p2y = toRect.top - boardRect.top + toRect.height / 2;

            const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
            line.setAttribute("x1", p1x);
            line.setAttribute("y1", p1y);
            line.setAttribute("x2", p2x);
            line.setAttribute("y2", p2y);
            line.setAttribute("stroke", "#888");
            line.setAttribute("stroke-width", "3");
            line.setAttribute("stroke-linecap", "round");
            lines.appendChild(line);
        }

        // ‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á DOM render ‡πÅ‡∏•‡πâ‡∏ß
        setTimeout(() => {
            paths.forEach(([from, to]) => drawLine(from[1], from[0], to[1], to[0]));
            drawSpecialLine(0, 0, -10000, 0, "red", "left"); // ‡πÄ‡∏™‡πâ‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©
            drawSpecialLine(1, 6, 10000, 0, "red", "right");
            drawSpecialLine(0, 1, 0, -10000, "orange", "top");
            drawSpecialLine(4, 5, 0, 10000, "orange", "bottom");
            drawSpecialLine(0, 4, 0, -10000, "#ADD8E6", "top");
            drawSpecialLine(4, 0, 0, 10000, "#ADD8E6", "bottom");
        }, 0);

        // ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á Game Board ‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
        window.addEventListener('DOMContentLoaded', () => {
            const gameBoard = document.getElementById('game-board');
            const addPlayerDiv = document.getElementById('add-player-buttons');

            // üéØ ‡∏™‡∏•‡∏±‡∏ö input
            const urlWrapper = document.getElementById('url-input-wrapper');
            const textWrapper = document.getElementById('text-input-wrapper');
            const iconTypeRadios = document.querySelectorAll('input[name="icon-type"]');
            const uploadInputWrapper = document.getElementById('upload-input-wrapper');

            function hideModeInModalAll() {
                // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÉ‡∏ô Modal ‡πÄ‡∏õ‡πá‡∏ô URL Mode
                urlWrapper.classList.add('hidden');
                textWrapper.classList.add('hidden');
                uploadInputWrapper.classList.add('hidden');
            }

            iconTypeRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    hideModeInModalAll();

                    if (radio.value === 'url') {
                        urlWrapper.classList.remove('hidden');
                    } else if (radio.value === 'text') {
                        textWrapper.classList.remove('hidden');
                    } else if (radio.value === 'upload') {
                        uploadInputWrapper.classList.remove('hidden');
                    }
                });
            });

            document.querySelectorAll('#character-space > div').forEach((card, index) => {
                // Gold buttons
                card.querySelector('.gold-plus').addEventListener('click', () => {
                    updatePlayerStat(index, 'gold', 1);
                });
                card.querySelector('.gold-minus').addEventListener('click', () => {
                    updatePlayerStat(index, 'gold', -1);
                });

                // Orange buttons
                card.querySelector('.orange-plus').addEventListener('click', () => {
                    updatePlayerStat(index, 'orange', 1);
                });
                card.querySelector('.orange-minus').addEventListener('click', () => {
                    updatePlayerStat(index, 'orange', -1);
                });
            });

            setTimeout(() => {
                const boardRect = gameBoard.getBoundingClientRect();
                const boardHeight = boardRect.height;

                const btnCount = 4;
                const btnGap = 16;
                const btnSize = (boardHeight - btnGap * (btnCount - 1)) / btnCount;

                addPlayerDiv.style.height = boardHeight + "px";
                addPlayerDiv.innerHTML = "";

                for (let i = 0; i < btnCount; i++) {
                    const btn = document.createElement("button");
                    btn.type = "button";
                    btn.className = `add-player-btn flex items-center justify-center rounded-full bg-orange-400 hover:bg-orange-500 shadow w-[${btnSize}px] h-[${btnSize}px] text-white text-3xl transition-all`;
                    btn.style.width = btn.style.height = btnSize + "px";
                    btn.innerHTML = '<span class="pointer-events-none select-none">+</span>';
                    btn.title = "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô";
                    btn.dataset.index = i;
                    addPlayerDiv.appendChild(btn);
                    if (i < btnCount - 1) {
                        const gap = document.createElement("div");
                        gap.style.height = btnGap + "px";
                        addPlayerDiv.appendChild(gap);
                    }
                }

                // Dummy left space
                const leftSpace = document.getElementById('left-space');
                leftSpace.style.height = boardHeight + "px";
                leftSpace.innerHTML = "";
                for (let i = 0; i < btnCount; i++) {
                    const dummy = document.createElement("div");
                    dummy.className = `rounded-full w-[${btnSize}px] h-[${btnSize}px] opacity-0`;
                    dummy.style.width = dummy.style.height = btnSize + "px";
                    leftSpace.appendChild(dummy);
                    if (i < btnCount - 1) {
                        const gap = document.createElement("div");
                        gap.style.height = btnGap + "px";
                        leftSpace.appendChild(gap);
                    }
                }

                // Modal logic
                const modalBg = document.getElementById('player-modal-bg');
                const closeModal = document.getElementById('close-modal');
                const playerForm = document.getElementById('player-form');
                const playerImgInput = document.getElementById('player-img');
                const playerBorderInput = document.getElementById('player-border');
                let currentBtn = null;

                // ‡πÄ‡∏õ‡∏¥‡∏î modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
                window.bindAddPlayerBtnEvents = function () {
                    document.querySelectorAll('.add-player-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            currentBtn = btn;
                            playerForm.reset();
                            playerBorderInput.value = "#f97316";
                            modalBg.classList.remove('hidden');
                        });
                    });
                }
                bindAddPlayerBtnEvents();

                // ‡∏õ‡∏¥‡∏î modal
                closeModal.addEventListener('click', () => {
                    modalBg.classList.add('hidden');
                    // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÉ‡∏ô Modal ‡πÄ‡∏õ‡πá‡∏ô URL Mode
                    hideModeInModalAll();
                    urlWrapper.classList.remove('hidden');
                });
                modalBg.addEventListener('click', (e) => {
                    if (e.target === modalBg) modalBg.classList.add('hidden');
                });

                // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ submit ‡∏ü‡∏≠‡∏£‡πå‡∏°
                const playerUploadInput = document.getElementById('player-upload');
                playerForm.addEventListener('submit', async (e) => {
                    e.preventDefault();

                    if (!currentBtn) return;

                    // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÉ‡∏ô Modal ‡πÄ‡∏õ‡πá‡∏ô URL Mode
                    hideModeInModalAll();
                    urlWrapper.classList.remove('hidden');

                    const borderColor = playerBorderInput.value;

                    let imgUrl = "";
                    const iconType = document.querySelector('input[name="icon-type"]:checked').value;

                    if (iconType === "url") {
                        imgUrl = playerImgInput.value;
                    } else if (iconType === "text") {
                        const emoji = document.getElementById("player-text").value.trim();
                        if (!emoji) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°");
                        imgUrl = generateImageFromText(emoji);
                    } else if (iconType === "upload") {
                        const file = playerUploadInput.files[0];
                        if (!file) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏∞");
                        imgUrl = await new Promise(resolve => {
                            const reader = new FileReader();
                            reader.onload = (ev) => resolve(ev.target.result);
                            reader.readAsDataURL(file);
                        });
                    }

                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏ó‡∏ô‡∏õ‡∏∏‡πà‡∏°
                    const img = document.createElement('img');
                    img.src = imgUrl;
                    img.alt = "Player";
                    img.className = "player-img rounded-full object-cover cursor-pointer";
                    img.style.width = img.style.height = currentBtn.style.width;
                    img.style.border = `4px solid ${borderColor}`;
                    img.style.background = "#fff";
                    img.style.boxShadow = "0 2px 8px rgba(0,0,0,0.15)";
                    img.dataset.index = currentBtn.dataset.index;

                    // ‡πÄ‡∏û‡∏¥‡πà‡∏° contextmenu ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏ö
                    img.addEventListener('contextmenu', function (e) {
                        e.preventDefault();
                        // ‡∏•‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏î‡∏¥‡∏°‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
                        document.querySelectorAll('.player-context-menu').forEach(m => m.remove());

                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏ô‡∏π
                        const menu = document.createElement('div');
                        menu.className = "player-context-menu absolute bg-white border rounded shadow px-3 py-2 text-sm z-50";
                        menu.style.top = e.clientY + "px";
                        menu.style.left = e.clientX + "px";
                        menu.innerHTML = `<button class="text-red-600 hover:underline" type="button">‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</button>`;

                        // ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î
                        menu.querySelector('button').addEventListener('click', () => {
                            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏ó‡∏ô img
                            const newBtn = createAddPlayerButton(img.dataset.index, parseFloat(img.style.width));
                            img.replaceWith(newBtn);
                            bindAddPlayerBtnEvents();
                            updateCharacterSpace();
                            menu.remove();

                            // üî• ‡∏•‡∏ö‡∏ï‡∏±‡∏ß‡∏´‡∏°‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö dataset.index
                            const token = board.querySelector(`.absolute[data-index="${img.dataset.index}"]`);
                            if (token) token.remove();
                        });


                        // ‡∏•‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏∑‡πà‡∏ô
                        document.body.addEventListener('click', function removeMenu(ev) {
                            if (!menu.contains(ev.target)) {
                                menu.remove();
                                document.body.removeEventListener('click', removeMenu);
                            }
                        });

                        document.body.appendChild(menu);
                    });

                    currentBtn.replaceWith(img);
                    updateCharacterSpace();

                    modalBg.classList.add('hidden');
                    currentBtn = null;

                    // ‡∏´‡∏≤ cell START
                    const startCell = [...document.querySelectorAll('.cell')].find(cell => {
                        return cell.textContent.includes("START");
                    });
                    if (startCell) {
                        const token = document.createElement('div');
                        token.className = "absolute rounded-full border-4 cursor-grab active:cursor-grabbing";
                        token.style.width = "48px";
                        token.style.height = "48px";
                        token.style.backgroundImage = `url(${imgUrl})`;
                        token.style.backgroundSize = "cover";
                        token.style.borderColor = borderColor;
                        token.style.backgroundColor = "#fff";
                        token.dataset.index = img.dataset.index;

                        // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                        const rect = startCell.getBoundingClientRect();
                        const boardRect = board.getBoundingClientRect();
                        token.style.left = `${rect.left - boardRect.left + rect.width / 2 - 16}px`;
                        token.style.top = `${rect.top - boardRect.top + rect.height / 2 - 16}px`;

                        // ‡πÉ‡∏´‡πâ‡∏•‡∏≤‡∏Å‡πÑ‡∏î‡πâ
                        token.draggable = true;
                        token.addEventListener('dragstart', (e) => {
                            e.dataTransfer.setData('text/plain', token.dataset.index);
                            token.classList.add("opacity-50");
                        });
                        token.addEventListener('dragend', (e) => {
                            token.classList.remove("opacity-50");
                        });

                        // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏≤‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤ board
                        board.appendChild(token);
                    }
                });
            }, 0);
        });

        // ‡πÉ‡∏´‡πâ‡∏ß‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
        board.addEventListener('dragover', (e) => {
            e.preventDefault();
        });

        board.addEventListener('drop', (e) => {
            e.preventDefault();
            const index = e.dataTransfer.getData('text/plain');
            const droppedToken = board.querySelector(`.absolute[data-index="${index}"]`);
            if (droppedToken) {
                const offsetX = 24; // ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏°‡∏≤‡∏Å
                const offsetY = 24;
                const boardBox = board.getBoundingClientRect();
                droppedToken.style.left = `${e.clientX - boardBox.left - offsetX}px`;
                droppedToken.style.top = `${e.clientY - boardBox.top - offsetY}px`;
            }
        });

    </script>

    <script>
        function generateImageFromText(text, color = "#000", fontSize = 48) {
            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");
            canvas.width = 128;
            canvas.height = 128;
            ctx.fillStyle = "#fff";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.font = `${fontSize}px sans-serif`;
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillStyle = color;
            ctx.fillText(text, canvas.width / 2, canvas.height / 2);
            return canvas.toDataURL("image/png");
        }
    </script>

    <!-- script ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö character page -->
    <script>
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
        let playerStats = {
            0: { gold: 2, orange: 0 },
            1: { gold: 2, orange: 0 },
            2: { gold: 2, orange: 0 },
            3: { gold: 2, orange: 0 }
        };

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
        function updatePlayerStat(index, type, change) {
            if (playerStats[index]) {
                playerStats[index][type] = playerStats[index][type] + change;
                updateCharacterSpace();
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏≤‡∏Å add-player-buttons
        function getPlayerData(index) {
            const playerElement = document.querySelector(`.player-img[data-index="${index}"]`);
            if (playerElement) {
                return {
                    src: playerElement.src,
                    border: playerElement.style.borderColor || "#f97316"
                };
            }
            return null;
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï character-space
        function updateCharacterSpace() {
            const characterCards = document.querySelectorAll('#character-space > div');

            for (let i = 0; i < 4; i++) {
                const playerData = getPlayerData(i);
                const card = characterCards[i];
                const img = card.querySelector('img');
                const goldCount = card.querySelector('.gold-count');
                const orangeCount = card.querySelector('.orange-count');

                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏π‡∏õ‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡∏ö
                if (playerData) {
                    img.src = playerData.src;
                    img.style.borderColor = playerData.border;
                    img.style.opacity = '1';
                } else {
                    img.src = '';
                    img.style.borderColor = '#f97316';
                    img.style.opacity = '0.3';
                }

                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
                goldCount.textContent = playerStats[i].gold;
                orangeCount.textContent = playerStats[i].orange;
            }
        }
    </script>

    <!-- script ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö index -->
    <script>
        const btnPageBoard = document.getElementById("btnPageBoard");
        const btnPageChar = document.getElementById("btnPageChar");
        const btnPageShop = document.getElementById("btnPageShop");

        function changePageBoard() {
            btnPageBoard.classList = "w-full text-left px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-300 transition";
            btnPageChar.classList = "w-full text-left px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400 transition";
            btnPageShop.classList = "w-full text-left px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400 transition";
            document.getElementById("character-space").classList.add("hidden");
            document.getElementById("game-board-space").classList.remove("hidden");
        }
        function changePageChar() {
            btnPageBoard.classList = "w-full text-left px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400 transition";
            btnPageChar.classList = "w-full text-left px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-300 transition";
            btnPageShop.classList = "w-full text-left px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400 transition";
            document.getElementById("game-board-space").classList.add("hidden");
            document.getElementById("character-space").classList.remove("hidden");
        }
        function changePageShop() {
            btnPageBoard.classList = "w-full text-left px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400 transition";
            btnPageChar.classList = "w-full text-left px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400 transition";
            btnPageShop.classList = "w-full text-left px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-300 transition";
            document.getElementById("game-board-space").classList.add("hidden");
            document.getElementById("character-space").classList.add("hidden");
        }

        function sidebar() {
            const toggleSidebar = document.getElementById("toggleSidebar");
            const sidebar = document.getElementById("sidebar");

            sidebar.classList.toggle("-translate-x-full");
        }

        function createAddPlayerButton(index, size) {
            const btn = document.createElement("button");
            btn.type = "button";
            btn.className = `add-player-btn flex items-center justify-center rounded-full bg-orange-400 hover:bg-orange-500 shadow text-white text-3xl transition-all`;
            btn.style.width = btn.style.height = `${size}px`;
            btn.innerHTML = '<span class="pointer-events-none select-none">+</span>';
            btn.title = "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô";
            btn.dataset.index = index;
            return btn;
        }

        // SAVE LOGIC
        document.getElementById('saveBtn').addEventListener('click', () => {
            const saveData = { layout };

            for (let i = 0; i < 4; i++) {
                const player = document.querySelector(`.player-img[data-index="${i}"]`);
                if (player) {
                    saveData[`player${i + 1}`] = {
                        src: player.src,
                        border: player.style.borderColor || "#f97316"
                    };
                } else {
                    saveData[`player${i + 1}`] = null;
                }
            }

            const blob = new Blob([JSON.stringify(saveData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'game_save.json';
            a.click();
            URL.revokeObjectURL(url);
        });


        // LOAD LOGIC
        let hasLoadedBefore = false;
        document.getElementById('loadFile').addEventListener('change', (e) => {
            if (!hasLoadedBefore) {
                const confirmRefresh = confirm("‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏∞‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ\n\n‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πà‡∏≠‡πÄ‡∏•‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?");
                if (!confirmRefresh) {
                    e.target.value = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå input ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ
                    return;
                }
                hasLoadedBefore = true;
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                try {
                    const data = JSON.parse(ev.target.result);
                    if (!Array.isArray(data.layout)) throw "layout missing";

                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï layout ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£
                    layout = data.layout;

                    // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô playerStats ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                    playerStats = {
                        0: { gold: 2, orange: 0 },
                        1: { gold: 2, orange: 0 },
                        2: { gold: 2, orange: 0 },
                        3: { gold: 2, orange: 0 }
                    };

                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ö‡∏ô‡∏ö‡∏≠‡∏£‡πå‡∏î
                    data.layout.forEach((row, y) => {
                        row.forEach((type, x) => {
                            const div = document.querySelector(`.cell[data-row="${y}"][data-col="${x}"]`);
                            if (!div) return;  // ‡∏ä‡πà‡∏≠‡∏á null ‡∏Å‡πá‡∏Ç‡πâ‡∏≤‡∏°
                            const typeSpan = div.querySelector('.cell-type');
                            loadLayout(type, div, typeSpan);
                        });
                    });

                    // ‡∏•‡∏ö token ‡∏ó‡∏µ‡πà‡∏°‡∏µ data-index (‡∏ï‡∏±‡∏ß‡∏´‡∏°‡∏≤‡∏Å)
                    document.querySelectorAll('#game-board .absolute[data-index]').forEach(el => el.remove());

                    // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• JSON
                    for (let i = 0; i < 4; i++) {
                        const key = `player${i + 1}`;
                        const src = data[key];
                        if (src) {
                            createPlayerFromSrc(i, src);
                        }
                    }
                } catch (err) {
                    console.error("Error loading file:", err);
                    alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡πà‡∏∞ üçä");
                }
                // ‡∏•‡∏ö‡∏Ñ‡πà‡∏≤ loadFile ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ
                e.target.value = '';
            };
            reader.readAsText(file);
        });

        function createPlayerFromSrc(index, data) {
            const addPlayerDiv = document.getElementById('add-player-buttons');
            const currentBtn = addPlayerDiv.querySelector(`[data-index="${index}"]`);
            if (!currentBtn) return;

            const btnSize = currentBtn.offsetWidth;
            const imgUrl = typeof data === "string" ? data : data.src;
            const border = typeof data === "string" ? "#f97316" : data.border || "#f97316";

            const img = document.createElement('img');
            img.src = imgUrl;
            img.alt = "Player";
            img.className = "player-img rounded-full object-cover cursor-pointer";
            img.style.width = img.style.height = btnSize + "px";
            img.style.border = `4px solid ${border}`;
            img.style.background = "#fff";
            img.style.boxShadow = "0 2px 8px rgba(0,0,0,0.15)";
            img.dataset.index = index;


            // ‡πÄ‡∏û‡∏¥‡πà‡∏° contextmenu ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏ö (copy logic ‡πÄ‡∏î‡∏¥‡∏°)
            img.addEventListener('contextmenu', function (e) {
                e.preventDefault();
                document.querySelectorAll('.player-context-menu').forEach(m => m.remove());

                const menu = document.createElement('div');
                menu.className = "player-context-menu absolute bg-white border rounded shadow px-3 py-2 text-sm z-50";
                menu.style.top = e.clientY + "px";
                menu.style.left = e.clientX + "px";
                menu.innerHTML = `<button class="text-red-600 hover:underline" type="button">‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</button>`;

                menu.querySelector('button').addEventListener('click', () => {
                    const newBtn = createAddPlayerButton(index, btnSize);
                    img.replaceWith(newBtn);
                    window.bindAddPlayerBtnEvents();
                    updateCharacterSpace();
                    menu.remove();

                    board.querySelectorAll(`.absolute[data-index="${index}"]`).forEach(token => token.remove());
                });

                document.body.addEventListener('click', function removeMenu(ev) {
                    if (!menu.contains(ev.target)) {
                        menu.remove();
                        document.body.removeEventListener('click', removeMenu);
                    }
                });

                document.body.appendChild(menu);
            });

            currentBtn.replaceWith(img);

            // ‡πÄ‡∏û‡∏¥‡πà‡∏° token ‡∏ó‡∏µ‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á START
            const startCell = [...document.querySelectorAll('.cell')].find(cell => {
                return cell.textContent.includes("START");
            });

            if (startCell) {
                const token = document.createElement('div');
                token.className = "absolute rounded-full border-4 cursor-grab active:cursor-grabbing";
                token.style.width = "48px";
                token.style.height = "48px";
                token.style.backgroundImage = `url(${imgUrl})`;
                token.style.backgroundSize = "cover";
                token.style.borderColor = border;
                token.style.backgroundColor = "#fff";
                token.dataset.index = index;

                const rect = startCell.getBoundingClientRect();
                const boardRect = board.getBoundingClientRect();
                token.style.left = `${rect.left - boardRect.left + rect.width / 2 - 16}px`;
                token.style.top = `${rect.top - boardRect.top + rect.height / 2 - 16}px`;

                token.draggable = true;
                token.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', token.dataset.index);
                    token.classList.add("opacity-50");
                });
                token.addEventListener('dragend', (e) => {
                    token.classList.remove("opacity-50");
                });

                board.appendChild(token);
                updateCharacterSpace();
            }
        }
    </script>

</body>

</html>